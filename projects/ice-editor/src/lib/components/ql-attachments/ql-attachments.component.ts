import {Component, ElementRef, OnInit, Optional, ViewChild} from '@angular/core';
import {IceEditorComponent} from '../../ice-editor.component';
import {QlInsertComponent} from '../ql-insert/ql-insert.component';

@Component({
  selector: 'ql-attachments',
  template: `
    <button (click)="addAttachment()" type="button" class="ql-attachment" data-label="附件" style="">
      <!--?xml version="1.0" encoding="utf-8"?-->
      <input style="display: none" type="file" #file (change)="upload($event)">
      <svg version="1.1" id="图层_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 17 17" style="enable-background:new 0 0 17 17" xml:space="preserve"> <desc>Created with Sketch.</desc>
        <g id="Page-1"> <g id="附件-修正版"> <g id="Combined-Shape"> <path d="M6.383,11.264c-0.267,0.268-0.267,0.703,0,0.971c0.267,0.268,0.699,0.268,0.966,0l5.273-5.301l0.604,0.607
				l-5.274,5.302l-0.604-0.607l0.001-0.001l0.604,0.607c-0.6,0.603-1.573,0.603-2.173,0c-0.594-0.597-0.6-1.562-0.017-2.167l0,0
				l3.381-3.399c0.167-0.168,0.437-0.168,0.604,0s0.167,0.439,0,0.607L6.383,11.264L6.383,11.264z M9.483,3.779l0.604,0.607
				l-5.432,5.46L4.051,9.239L9.483,3.779z M9.483,3.779c1.033-1.039,2.709-1.039,3.742,0s1.033,2.723,0,3.762l-0.604-0.607
				c0.7-0.704,0.7-1.845,0-2.548c-0.7-0.704-1.835-0.704-2.535,0L9.483,3.779z M9.12,14.337c-1.4,1.407-3.67,1.407-5.07,0
				s-1.4-3.689,0-5.096l0.604,0.607c-1.067,1.072-1.067,2.811,0,3.883s2.796,1.072,3.863,0L9.12,14.337z M10.629,12.213
				c0.167,0.168,0.167,0.439,0,0.607L9.12,14.337L8.516,13.73l1.509-1.517C10.192,12.046,10.462,12.046,10.629,12.213z"></path>
          <path d="M6.585,15.442c-0.971,0-1.884-0.38-2.571-1.07c-1.406-1.413-1.417-3.705-0.034-5.133l0.032-0.032
				c0,0,0.001-0.001,0.002-0.002L4.05,9.169l5.398-5.425l0,0l0.035-0.036c0.505-0.489,1.167-0.758,1.87-0.758
				c0.721,0,1.397,0.282,1.906,0.794c1.04,1.044,1.052,2.737,0.035,3.796v0L13.26,7.576l-5.309,5.338L7.95,12.913
				c-0.295,0.278-0.678,0.431-1.084,0.431c-0.424,0-0.822-0.166-1.122-0.468c-0.609-0.611-0.617-1.614-0.018-2.236L9.108,7.24
				C9.197,7.15,9.317,7.1,9.444,7.1c0,0,0,0,0.001,0c0.127,0,0.247,0.05,0.337,0.141c0.186,0.187,0.186,0.491,0,0.677l-3.364,3.381
				c-0.247,0.249-0.247,0.652,0,0.9c0.119,0.12,0.278,0.187,0.447,0.187c0.152,0,0.295-0.054,0.41-0.151l-0.006-0.007l0.048-0.032
				l5.273-5.3c0.676-0.684,0.675-1.792-0.004-2.474c-0.329-0.331-0.767-0.513-1.232-0.513c-0.465,0-0.902,0.182-1.231,0.513
				l-0.035,0.036l-5.4,5.428c-1.043,1.051-1.042,2.76,0.002,3.811c0.506,0.509,1.18,0.789,1.896,0.789
				c0.716,0,1.389-0.28,1.895-0.789l1.51-1.518c0.186-0.186,0.488-0.186,0.674,0l0,0c0.187,0.187,0.187,0.491,0,0.678l-1.509,1.517
				c-0.001,0.002-0.003,0.003-0.004,0.005L9.12,14.408v-0.001C8.438,15.075,7.539,15.442,6.585,15.442z M4.05,9.312
				c-1.343,1.389-1.332,3.616,0.035,4.99c0.667,0.671,1.555,1.041,2.5,1.041c0.928,0,1.801-0.357,2.465-1.006l-0.534-0.536
				c-0.521,0.506-1.204,0.784-1.93,0.784c-0.743,0-1.442-0.291-1.968-0.819c-1.072-1.078-1.084-2.826-0.035-3.919L4.05,9.312z
				 M8.586,13.73l0.534,0.535l1.474-1.48c0.146-0.148,0.146-0.389,0-0.537c-0.146-0.146-0.387-0.146-0.533,0L8.586,13.73z
				 M9.445,7.2C9.444,7.2,9.444,7.2,9.445,7.2c-0.102,0-0.195,0.04-0.267,0.111L5.798,10.71c-0.562,0.582-0.554,1.522,0.017,2.096
				c0.281,0.282,0.654,0.438,1.051,0.438c0.379,0,0.737-0.142,1.014-0.401l-0.533-0.536c-0.133,0.116-0.302,0.18-0.48,0.18
				c-0.196,0-0.38-0.076-0.519-0.216c-0.285-0.286-0.285-0.754,0-1.041l3.365-3.381c0.146-0.148,0.146-0.389,0-0.537
				C9.641,7.239,9.546,7.2,9.445,7.2z M7.419,12.234l0.533,0.536l5.202-5.23l-0.533-0.536L7.419,12.234z M4.121,9.239l0.533,0.535
				l5.362-5.389L9.483,3.85L4.121,9.239z M12.691,6.934l0.533,0.536c0.978-1.02,0.966-2.649-0.035-3.655
				c-0.49-0.493-1.143-0.765-1.836-0.765c-0.676,0-1.313,0.259-1.799,0.73l0.532,0.536c0.344-0.328,0.792-0.507,1.267-0.507
				c0.493,0,0.955,0.192,1.303,0.542C13.363,5.061,13.375,6.209,12.691,6.934z"></path> </g> </g> </g> </svg>
    </button>`,
  styleUrls: ['./ql-attachments.component.css']
})
export class QlAttachmentsComponent implements OnInit {

  constructor(private editor: IceEditorComponent, @Optional() private ql_insert: QlInsertComponent) {
  }

  ngOnInit() {
  }

  @ViewChild('file', {static: false}) file: ElementRef;

  addAttachment() {
    this.file.nativeElement.click();
  }

  upload(event) {
    const quill = this.editor.quill;
    const selection = this.editor.quill.getSelection(true);
    const file = event.target.files[0];
    this.editor.quill.insertEmbed(selection['index'], 'ql-attachment', file);
    this.ql_insert && this.ql_insert.setShow();
  }
}
